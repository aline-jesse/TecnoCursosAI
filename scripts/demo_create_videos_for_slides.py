#!/usr/bin/env python3
"""
üé¨ DEMONSTRA√á√ÉO: create_videos_for_slides
==========================================

Este script demonstra o uso da nova fun√ß√£o create_videos_for_slides()
que foi implementada no arquivo app/utils.py. Esta fun√ß√£o permite criar
m√∫ltiplos v√≠deos automaticamente a partir de listas de textos e √°udios.

Autor: Sistema TecnoCursos AI
Data: 2025
"""

import os
import sys
from pathlib import Path

# Adicionar o diret√≥rio principal ao path do Python
sys.path.append(str(Path(__file__).parent))

try:
    from app.utils import create_videos_for_slides, batch_create_videos_info, validate_batch_creation_params
    print("‚úÖ Fun√ß√µes importadas com sucesso!")
except ImportError as e:
    print(f"‚ùå Erro ao importar fun√ß√µes: {e}")
    print("üîß Verifique se as depend√™ncias est√£o instaladas: pip install moviepy pillow")
    sys.exit(1)

def demo_create_videos_for_slides():
    """
    Demonstra o uso da fun√ß√£o create_videos_for_slides com dados de exemplo.
    
    Esta fun√ß√£o cria um exemplo pr√°tico de como usar a nova funcionalidade
    para gerar m√∫ltiplos v√≠deos a partir de listas de textos e √°udios.
    """
    print("\n" + "="*60)
    print("üé¨ DEMONSTRA√á√ÉO: create_videos_for_slides")
    print("="*60)
    
    # Dados de exemplo para demonstra√ß√£o
    slides_text_list = [
        "Bem-vindos ao TecnoCursos AI! Nesta aula vamos aprender sobre intelig√™ncia artificial e suas aplica√ß√µes no mundo moderno. A IA est√° transformando diversos setores da economia.",
        
        "Python √© uma das linguagens mais populares para machine learning. Suas bibliotecas como TensorFlow, PyTorch e Scikit-learn facilitam o desenvolvimento de modelos de IA.",
        
        "Obrigado por assistir esta apresenta√ß√£o! Continue estudando e praticando para se tornar um especialista em tecnologia. O futuro √© dos que se preparam hoje!",
    ]
    
    # Caminhos de exemplo para arquivos de √°udio (voc√™ precisaria ter estes arquivos)
    audios_path_list = [
        "app/static/audios/intro_tecnica.wav",    # √Åudio para slide 1
        "app/static/audios/curso_python.wav",     # √Åudio para slide 2  
        "app/static/audios/relatorio_exec.wav",   # √Åudio para slide 3
    ]
    
    # Pasta onde os v√≠deos ser√£o salvos
    output_folder = "videos/demo_slides_output"
    
    print(f"üìù Preparando para processar {len(slides_text_list)} slides:")
    for i, (text, audio) in enumerate(zip(slides_text_list, audios_path_list), 1):
        print(f"   {i}. Texto: {text[:50]}...")
        print(f"      √Åudio: {audio}")
    
    print(f"\nüìÅ Pasta de output: {output_folder}")
    
    # Verificar se os arquivos de √°udio existem
    print("\nüîç Verificando arquivos de √°udio...")
    missing_files = []
    for audio_path in audios_path_list:
        if os.path.exists(audio_path):
            print(f"   ‚úÖ {audio_path}")
        else:
            print(f"   ‚ùå {audio_path} (n√£o encontrado)")
            missing_files.append(audio_path)
    
    if missing_files:
        print(f"\n‚ö†Ô∏è AVISO: {len(missing_files)} arquivos de √°udio n√£o foram encontrados.")
        print("üí° Para executar a demonstra√ß√£o completa, certifique-se de ter os arquivos de √°udio.")
        print("üéµ Voc√™ pode usar arquivos de √°udio existentes ou gerar novos com TTS.")
        
        # Pergunta se o usu√°rio quer continuar mesmo assim
        choice = input("\n‚ùì Deseja continuar mesmo assim? (s/n): ").lower()
        if choice != 's':
            print("‚ùå Demonstra√ß√£o cancelada pelo usu√°rio.")
            return
    
    print("\nüìä Calculando informa√ß√µes de processamento...")
    
    # Obter informa√ß√µes sobre o processamento em lote
    batch_info = batch_create_videos_info(
        slides_count=len(slides_text_list),
        template="modern",
        resolution="hd"
    )
    
    print(f"‚è±Ô∏è Tempo estimado: {batch_info['estimated_time_minutes']} minutos")
    print(f"üíæ Espa√ßo estimado: {batch_info['estimated_disk_space_mb']} MB")
    print(f"üß† RAM recomendada: {batch_info['recommended_memory_mb']} MB")
    
    print("\nüí° Dicas de otimiza√ß√£o:")
    for tip in batch_info['processing_tips']:
        print(f"   {tip}")
    
    # Validar par√¢metros antes do processamento
    print("\nüîç Validando par√¢metros...")
    validation_result = validate_batch_creation_params(
        slides_text_list=slides_text_list,
        audios_path_list=audios_path_list,
        output_folder=output_folder
    )
    
    if validation_result['errors']:
        print("‚ùå Erros encontrados:")
        for error in validation_result['errors']:
            print(f"   ‚Ä¢ {error}")
    
    if validation_result['warnings']:
        print("‚ö†Ô∏è Avisos:")
        for warning in validation_result['warnings']:
            print(f"   ‚Ä¢ {warning}")
    
    print(f"\nüìã Resumo da valida√ß√£o:")
    summary = validation_result['summary']
    print(f"   üìÑ Total de slides: {summary['total_slides']}")
    print(f"   üéµ Total de √°udios: {summary['total_audios']}")
    print(f"   ‚ùå Erros: {summary['errors_count']}")
    print(f"   ‚ö†Ô∏è Avisos: {summary['warnings_count']}")
    
    # Decidir se continuar com o processamento
    if not validation_result['is_valid']:
        print("\n‚ùå N√£o √© poss√≠vel continuar devido aos erros de valida√ß√£o.")
        return
    
    print("\nüöÄ Iniciando processamento dos v√≠deos...")
    
    try:
        # Executar a fun√ß√£o principal
        generated_videos = create_videos_for_slides(
            slides_text_list=slides_text_list,
            audios_path_list=audios_path_list,
            output_folder=output_folder,
            template="modern",        # Template moderno e profissional
            resolution="hd",          # Resolu√ß√£o HD (720p)
            animations=True,          # Ativar anima√ß√µes
            background_style="gradient"  # Fundo gradiente
        )
        
        # Exibir resultados
        print(f"\nüéâ Processamento conclu√≠do com sucesso!")
        print(f"‚úÖ {len(generated_videos)} v√≠deos foram criados:")
        
        total_size = 0
        for i, video_path in enumerate(generated_videos, 1):
            if os.path.exists(video_path):
                file_size = os.path.getsize(video_path)
                total_size += file_size
                size_mb = file_size / 1024 / 1024
                print(f"   {i}. {os.path.basename(video_path)} ({size_mb:.2f} MB)")
            else:
                print(f"   {i}. {os.path.basename(video_path)} (arquivo n√£o encontrado)")
        
        print(f"\nüíæ Tamanho total: {total_size / 1024 / 1024:.2f} MB")
        print(f"üìÅ Pasta: {output_folder}")
        
    except Exception as e:
        print(f"\n‚ùå Erro durante o processamento: {e}")
        print("\nüí° Dicas para resolver:")
        print("1. Verifique se todos os arquivos de √°udio existem")
        print("2. Certifique-se de ter permiss√µes de escrita na pasta de output")
        print("3. Instale as depend√™ncias: pip install moviepy pillow")
        print("4. Verifique se h√° espa√ßo suficiente em disco")

def create_sample_audio_files():
    """
    Cria arquivos de √°udio de exemplo usando TTS para a demonstra√ß√£o.
    
    Esta fun√ß√£o pode ser usada para gerar os arquivos de √°udio necess√°rios
    para a demonstra√ß√£o caso eles n√£o existam.
    """
    print("\nüéµ Criando arquivos de √°udio de exemplo...")
    
    try:
        from app.utils import create_tts_audio_file
        
        # Textos para gerar √°udios
        audio_texts = [
            "Bem-vindos ao TecnoCursos AI! Hoje vamos aprender sobre intelig√™ncia artificial.",
            "Python √© uma linguagem muito popular para machine learning e ci√™ncia de dados.",
            "Obrigado por assistir! Continue estudando e praticando para se tornar um especialista."
        ]
        
        # Caminhos dos arquivos de √°udio
        audio_paths = [
            "app/static/audios/demo_slide_1.wav",
            "app/static/audios/demo_slide_2.wav", 
            "app/static/audios/demo_slide_3.wav"
        ]
        
        # Criar pasta de √°udios se n√£o existir
        os.makedirs("app/static/audios", exist_ok=True)
        
        # Gerar cada arquivo de √°udio
        for i, (text, path) in enumerate(zip(audio_texts, audio_paths), 1):
            print(f"   üé§ Gerando √°udio {i}/3: {os.path.basename(path)}")
            
            # Usar TTS para criar arquivo de √°udio
            result = create_tts_audio_file(
                text=text,
                output_path=path,
                provider="gtts",
                language="pt-br"
            )
            
            if result.get('success'):
                print(f"   ‚úÖ Criado: {path}")
            else:
                print(f"   ‚ùå Erro: {result.get('error', 'Desconhecido')}")
        
        print("‚úÖ Arquivos de √°udio de exemplo criados!")
        return audio_paths
        
    except ImportError:
        print("‚ö†Ô∏è TTS n√£o dispon√≠vel - usando arquivos existentes")
        return None
    except Exception as e:
        print(f"‚ùå Erro ao criar arquivos de √°udio: {e}")
        return None

def main():
    """
    Fun√ß√£o principal que executa a demonstra√ß√£o completa.
    """
    print("üé¨ DEMONSTRA√á√ÉO: create_videos_for_slides")
    print("==========================================")
    print("Esta demonstra√ß√£o mostra como usar a nova fun√ß√£o para criar")
    print("m√∫ltiplos v√≠deos automaticamente a partir de textos e √°udios.")
    
    # Verificar se os arquivos de √°udio existem
    audio_files = [
        "app/static/audios/intro_tecnica.wav",
        "app/static/audios/curso_python.wav", 
        "app/static/audios/relatorio_exec.wav"
    ]
    
    missing_count = sum(1 for f in audio_files if not os.path.exists(f))
    
    if missing_count > 0:
        print(f"\n‚ö†Ô∏è {missing_count} arquivos de √°udio n√£o encontrados.")
        choice = input("üéµ Deseja criar arquivos de exemplo com TTS? (s/n): ").lower()
        
        if choice == 's':
            created_files = create_sample_audio_files()
            if created_files:
                print("‚úÖ Arquivos criados! Continuando com a demonstra√ß√£o...")
            else:
                print("‚ùå N√£o foi poss√≠vel criar arquivos. Usando demonstra√ß√£o limitada.")
    
    # Executar demonstra√ß√£o principal
    demo_create_videos_for_slides()
    
    print("\n" + "="*60)
    print("üìö INFORMA√á√ïES ADICIONAIS")
    print("="*60)
    print("üìñ Fun√ß√£o implementada: create_videos_for_slides()")
    print("üìÅ Localiza√ß√£o: app/utils.py")
    print("üîß Depend√™ncias: moviepy, pillow")
    
    print("\nüí° Exemplo de uso program√°tico:")
    print("```python")
    print("from app.utils import create_videos_for_slides")
    print("")
    print("videos = create_videos_for_slides(")
    print("    slides_text_list=['Texto 1', 'Texto 2'],")
    print("    audios_path_list=['audio1.wav', 'audio2.wav'],")
    print("    output_folder='meus_videos',")
    print("    template='modern',")
    print("    resolution='hd'")
    print(")")
    print("```")
    
    print(f"\nüèÅ Demonstra√ß√£o conclu√≠da!")

if __name__ == "__main__":
    main() 